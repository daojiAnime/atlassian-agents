现在我为你提供完整的解决方案：

## 方案1：使用 docker buildx（推荐）

这是最简单且官方推荐的方法：

```bash
# 1. 创建并启用 buildx builder（如果还没有的话）
docker buildx create --name mybuilder --use

# 2. 构建多架构镜像并加载到 Docker（仅本地使用）
docker buildx build \
  --platform linux/arm64,linux/amd64 \
  -t your-image-name:latest \
  --load \
  .

# 3. 或者，直接构建并导出为 tar 文件（推荐用于两个架构）
# 需要分别构建两个架构，然后合并

# ARM64 构建
docker buildx build \
  --platform linux/arm64 \
  -t your-image-name:arm64 \
  --output type=docker,dest=./your-image-arm64.tar \
  .

# AMD64 构建
docker buildx build \
  --platform linux/amd64 \
  -t your-image-name:amd64 \
  --output type=docker,dest=./your-image-amd64.tar \
  .

# 4. 压缩 tar 文件
gzip your-image-arm64.tar
gzip your-image-amd64.tar
```

## 方案2：完整的自动化脚本

创建一个脚本文件来自动化整个过程：

```bash
#!/bin/bash

# build-docker-multiarch.sh
set -e

IMAGE_NAME=${1:-"your-image-name"}
IMAGE_TAG=${2:-"latest"}
OUTPUT_DIR=${3:-"./docker-images"}

# 颜色输出
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${YELLOW}Starting multi-architecture Docker build...${NC}"

# 创建输出目录
mkdir -p "$OUTPUT_DIR"

# 检查 buildx 是否可用
if ! docker buildx version > /dev/null 2>&1; then
    echo -e "${RED}Error: docker buildx not found. Please install Docker Desktop or enable buildx.${NC}"
    exit 1
fi

# 创建 builder（如果不存在）
BUILDER_NAME="multiarch-builder-$(date +%s)"
docker buildx create --name "$BUILDER_NAME" --use || true

# 构建 ARM64
echo -e "${YELLOW}Building for ARM64...${NC}"
docker buildx build \
    --platform linux/arm64 \
    -t "${IMAGE_NAME}:${IMAGE_TAG}-arm64" \
    --output "type=docker,dest=${OUTPUT_DIR}/${IMAGE_NAME}-arm64.tar" \
    .

if [ $? -eq 0 ]; then
    echo -e "${GREEN}ARM64 build successful${NC}"
    gzip -f "${OUTPUT_DIR}/${IMAGE_NAME}-arm64.tar"
    echo -e "${GREEN}Created: ${OUTPUT_DIR}/${IMAGE_NAME}-arm64.tar.gz${NC}"
else
    echo -e "${RED}ARM64 build failed${NC}"
    exit 1
fi

# 构建 AMD64
echo -e "${YELLOW}Building for AMD64...${NC}"
docker buildx build \
    --platform linux/amd64 \
    -t "${IMAGE_NAME}:${IMAGE_TAG}-amd64" \
    --output "type=docker,dest=${OUTPUT_DIR}/${IMAGE_NAME}-amd64.tar" \
    .

if [ $? -eq 0 ]; then
    echo -e "${GREEN}AMD64 build successful${NC}"
    gzip -f "${OUTPUT_DIR}/${IMAGE_NAME}-amd64.tar"
    echo -e "${GREEN}Created: ${OUTPUT_DIR}/${IMAGE_NAME}-amd64.tar.gz${NC}"
else
    echo -e "${RED}AMD64 build failed${NC}"
    exit 1
fi

echo -e "${GREEN}All builds completed successfully!${NC}"
echo -e "${GREEN}Output files:${NC}"
ls -lh "${OUTPUT_DIR}"/*.tar.gz
```

## 方案3：使用 OCI 格式导出（更灵活）

```bash
# 构建并导出为 OCI 格式
docker buildx build \
  --platform linux/arm64,linux/amd64 \
  -t your-image-name:latest \
  --output type=oci,dest=./output \
  .

# 压缩
tar -czf your-image-oci.tar.gz output/
```

## 快速命令参考

```bash
# 仅 ARM64
docker buildx build --platform linux/arm64 -t myimage:latest --output type=docker,dest=./myimage-arm64.tar . && gzip myimage-arm64.tar

# 仅 AMD64
docker buildx build --platform linux/amd64 -t myimage:latest --output type=docker,dest=./myimage-amd64.tar . && gzip myimage-amd64.tar

# 同时构建两个架构（保存到 Registry）
docker buildx build \
  --platform linux/arm64,linux/amd64 \
  -t registry.example.com/myimage:latest \
  --push \
  .
```

## 关键要点

1. **buildx** 是官方推荐的多架构构建工具
2. **Mac 上默认支持**：Docker Desktop 已内置 buildx 支持
3. **输出选项**：
   - `type=docker` - 导出为 Docker 镜像
   - `type=oci` - 导出为 OCI 格式
   - `type=image` - 推送到 registry
4. **压缩**：使用 `gzip` 或 `tar -czf` 压缩
5. **性能**：ARM64 在 Mac 上可能比 AMD64 快（Apple Silicon）

选择方案 2（脚本）是最实用的，可以直接使用或根据需求修改。